# Copyright 2018 D-Wave Systems Inc.
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#        http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
#
# =============================================================================
import unittest

import numpy as np

import dimod

try:
    from dimod import fix_variables
except ImportError:
    cpp = False
else:
    cpp = True


@unittest.skipUnless(cpp, "no cpp extensions built")
class TestFixVariables(unittest.TestCase):
    def test_3path(self):
        bqm = dimod.BinaryQuadraticModel.from_ising({'a': 10},
                                                    {'ab': -1, 'bc': 1})
        fixed = dimod.fix_variables(bqm)
        self.assertEqual(fixed, {'a': -1, 'b': -1, 'c': 1})

    def test_bug(self):
        # this problem came from a bug report
        bqm = dimod.BQM.from_ising({0: 10.523392650433879,
                                    1: -39048280688.88219,
                                    2: 55379310242.36428,
                                    3: -5.000842227386997,
                                    4: -16.690479543295037,
                                    5: 4.417499488585156,
                                    6: -24381010244.474003,
                                    7: 33693150368.672665,
                                    8: 17413951563.193893,
                                    9: -1.9989039139652438,
                                    10: -46279675131.17227,
                                    11: 27190352270.32409,
                                    12: 29665349603.963364,
                                    13: 74092231582.22266,
                                    14: -7.0913365565693285,
                                    15: 23181465364.41787,
                                    16: -10.273087811652433,
                                    17: -531512757273.64703,
                                    18: -1126767402.0293868,
                                    19: -42230450842.39054,
                                    20: -47033956592.14563,
                                    21: -27726720308.549458,
                                    22: 28637306751.479404,
                                    23: 1.0868645977455824,
                                    24: -20159445276.715168,
                                    25: -34567655953.99183,
                                    26: -19581468519.21248},
                                   {(9, 21): 5027306367.77281,
                                    (9, 22): 636173777.3249484,
                                    (9, 23): -0.6550686426634117,
                                    (9, 24): -5014960058.848128,
                                    (9, 25): 2916312929.956098,
                                    (9, 26): 3754766456.5539885,
                                    (10, 11): 6.780692101888206e+18,
                                    (10, 12): 1.5410344102459628e+19,
                                    (10, 13): 1.6096104754483446e+19,
                                    (10, 14): 3701994225.129975,
                                    (10, 15): -2.452029601362855e+19,
                                    (10, 16): 3288465898.828724,
                                    (10, 17): 2.658565804720803e+19,
                                    (10, 23): -382606162.56778306,
                                    (10, 24): -2.1804153197546942e+19,
                                    (11, 25): -1.8875523487611957e+19,
                                    (11, 26): 4.790306482624358e+18,
                                    (12, 13): -3.356432458024334e+19,
                                    (12, 14): 7747386504.96633,
                                    (12, 15): 1.2135530767786504e+19,
                                    (12, 16): 2383702628.489932,
                                    (12, 18): -9.596619364179165e+18,
                                    (12, 19): 1.219064925469795e+19,
                                    (12, 20): -2.5733271538151244e+19,
                                    (12, 21): -2.8763393131594457e+19,
                                    (12, 22): 3.1147212017876025e+19,
                                    (12, 23): -2516211152.8181996,
                                    (12, 24): -2.93218565686095e+19,
                                    (12, 25): -1.6431725371660515e+19,
                                    (12, 26): 5.430065520339268e+18,
                                    (13, 14): 4895321145.834405,
                                    (13, 15): -2.1224823296048124e+19,
                                    (13, 16): -727263493.1828315,
                                    (14, 24): -124098068.51084864,
                                    (14, 25): 3871900063.176464,
                                    (14, 26): -2094181138.8754666,
                                    (15, 16): -1683595992.2227316,
                                    (15, 17): -3.0216593722710663e+19,
                                    (15, 18): 3.805757487349459e+19,
                                    (15, 19): -1.9314726645306302e+19,
                                    (15, 20): -6.757868291924533e+18,
                                    (15, 21): 4.953853831669041e+18,
                                    (15, 22): 7.535973737137298e+18,
                                    (15, 23): -671093485.1265225,
                                    (25, 26): -9.08941137733334e+18})

        fixed = dimod.fix_variables(bqm, sampling_mode=False)
